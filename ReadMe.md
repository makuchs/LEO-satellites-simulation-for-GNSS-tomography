# Satellite Propagation and Analysis

This project provides tools to simulate satellite propagation using Two-Line Element (TLE) data, generate SPICE kernel files, convert state vectors between coordinate systems (TEME, ECEF, J2000/GCRS), and perform occultation analysis. It also includes functionality to compare simulated positions with those derived from SP3 files.

## Features

- **TLE Simulation**  
  Propagate satellite states using the [sgp4](https://pypi.org/project/sgp4/) library.

- **Coordinate Conversion**  
  Convert TEME state vectors to:
  - **ECEF** coordinates using [Skyfield](https://rhodesmill.org/skyfield/)  
  - **J2000** coordinates using [Astropy](https://www.astropy.org/)

- **SPICE Kernel Generation**  
  Generate SPK kernel files using [spiceypy](https://pypi.org/project/spiceypy/).

- **Occultation Analysis**  
  Analyze occultation events between satellites (module provided).

- **Position Comparison**  
  Compare simulated positions (from TLE propagation) with positions extracted from SP3 files.


## Project Structure

- **repo/**
  - **kernels/**  
    - `naif0012.tls` – SPICE kernel file  
    - `pck00011.tpc` – SPICE kernel file  
    - `de432s.bsp` – SPICE kernel file
    - **leo/** (kernels not included due to limited size of individual files)
    - **gnss/** (kernels not included due to limited size of individual files)
  - **examples/**
    - **SP3/**  
      - `44351_COSMIC2-2_2022.sp3` – Example SP3 file
    - **TLE/**  
      - `46317_LEMUR2SQUAREJAWS.txt` – Example TLE file
  - **output/**  - Folder for generated output (SPK kernels, CSV files)
  - **src/**
    - `__init__.py` 
    - `tle_simulation.py` – Module for TLE propagation, coordinate conversion, and SPICE kernel generation
    - `occultation.py` – Module for occultation analysis
    - `compare_positions.py` – Module for comparing SP3 and simulated positions
  - `main.py` – Main entry point (choose mode: simulation, occultation, compare)
  - `README.md` – Project documentation

## Dependencies

The project requires Python 3.x and the following packages:

- numpy
- sgp4
- skyfield
- astropy
- spiceypy

## Main Function Overview

The project is designed to be run via `main.py`, which provides a simple interface to select and execute one of three modes: **simulation**, **occultation**, or **compare**. The configuration settings in `main.py` allow you to specify file paths, date ranges, and other parameters that control the execution.

### Modes

- **simulation:**  
  - **Input:**  
    - A TLE file (e.g., `examples/TLE/46317_LEMUR2SQUAREJAWS.txt`).
  - **Process:**  
    - Loads TLE records and propagates satellite states using the sgp4 library.
    - Converts TEME state vectors to J2000 coordinates (for SPICE kernel generation) and to ECEF coordinates (for CSV output).
    - Uses the TLE epochs and a defined timestep (e.g., 1 second) to determine simulation times.
  - **Output:**  
    - Generates an SPICE kernel file (with a `.bsp` extension) stored in the output folder.
    - Creates a CSV file with ECEF positions for later comparison.
  - **Satellite:**  
    - Processes the satellite defined in the provided TLE file.

- **occultation:**  
  - **Input:**  
    - Folders containing SPICE kernels for LEO (e.g., `kernels/leo`) and GNSS (e.g., `kernels/gnss`) satellites.
    - A date range (e.g., from `2022-01-03` to `2022-01-10`).
  - **Process:**  
    - Loads the required SPICE kernels.
    - Iterates over each day within the specified date range.
    - For each day, processes pairs of LEO and GNSS kernel files to detect radio occultation events.
    - Occultation events are identified when the line-of-sight between the satellites falls within a defined field-of-view and over a designated area (e.g., Poland).
  - **Output:**  
    - Appends occultation event details (including event date, satellite positions, and tangent point coordinates) to a CSV file (e.g., `occultation_results.csv`).
  - **Satellite:**  
    - Works with the satellite data available in the provided kernel folders.

- **compare:**  
  - **Input:**  
    - An SP3 file (e.g., `examples/SP3/46317_LEMUR2SQUAREJAWS_2022.sp3`) containing precise ephemeris data.
    - The CSV file generated by the simulation mode.
    - A satellite identifier (e.g., `PL99`) used to match data between the two files.
  - **Process:**  
    - Parses the SP3 file to extract satellite positions over time.
    - Reads the CSV file for corresponding ECEF positions.
    - Identifies common epochs (timestamps) between the two datasets.
    - Computes the spatial differences between the SP3 and simulated positions.
    - Generates a plot to visualize the position differences over time.
  - **Output:**  
    - Displays a plot showing the differences in satellite positions derived from the SP3 and simulation data.
  - **Satellite:**  
    - Compares data for the satellite identified by the provided satellite ID.

### Execution Flow

Upon running `main.py`, the script checks the `MODE` configuration variable and calls the corresponding module function:
- For **simulation**, it calls `tle_simulation.run_simulation(...)`.
- For **occultation**, it calls `occultation.run_occultation(...)`.
- For **compare**, it calls `compare_positions.run_compare(...)`.

## Downloading TLE Data

To obtain current TLE data, you can use the following services:

- **Space-Track:**  
  This service requires registration. Once logged in, you can download TLE data manually or via their API. For more details, refer to the [Space-Track documentation](https://www.space-track.org/documentation).

- **CelesTrak:**  
  CelesTrak offers free and publicly accessible TLE data without requiring registration. You can find the latest TLE sets on the [CelesTrak website](https://celestrak.com).

These sources can be integrated into your project using HTTP requests or dedicated libraries for API interaction, which can help automate the data update process.

### File Naming Convention

Ensure that the SPICE kernel files for LEO and GNSS satellites follow the naming convention: `NORAD_SATNAME.bsp`.  
For example, if a satellite's NORAD identifier is `1234` and its name is `lemur2`, the kernel file should be named `1234_lemur2.bsp`.  
This naming scheme is essential for proper identification and processing within the project.

## Funding and Acknowledgments

This work was funded by the National Science Centre (NCN) Poland, by the Grant: UMO-2020/37/B/ST10/03703.
We thank SPIRE company for delivering RO data.

## Acknowledgments

This project makes use of:

The sgp4 library for TLE propagation.
The Skyfield library for coordinate transformations.
Astropy for time and coordinate management.
spiceypy for SPICE kernel operations.
Contributions and suggestions are welcome!
